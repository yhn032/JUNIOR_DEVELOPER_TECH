# JVM(Java Virtual Machine)
<br>

## 1. 개념 및 정의 
* 자바를 실행하기 위해 실제 컴퓨터가 아닌 소프트웨어로 구현한 가상 컴퓨터다.(<b>OS에 종속받지 않고 CPU가 Java를 인식, 실행할 수 있게 한다.</b>)
* Java와 OS의 중간에서 역할을 수행하기 때문에 <b>Java가 OS에 독립적이며(OS별로 다른 API를 구성할 필요가 없다.)</b>, 재사용이 가능하다.
  * 자바로 개발한 자바 응용프로그램은 OS가 아닌 JVM과 통신하고, JVM이 자바 응용프로그램으로부터 전달받은 명령을 해당 OS가 이해할 수 있는 코드로 변환하여 OS에 전달한다. 
* 메모리 관리와 GC을 수행한다.

## 1-2. 컴파일의 과정 (원시코드 -> 바이트 코드 -> JVM -> OS)
1. 자바 소스코드(=원시코드 *.java)는 CPU가 곧바로 인식하기 못하기 떄문에 이해할 수 있는 기계어로 컴파일을 해줘야 한다. 
2. Java Compiler(JDK 내부 bin폴더에 존재하는 <b>javac.exe</b>)가 JVM이 인식할 수 있는 Java Bytecode(*.class)로 변환한다.
3. 마지막으로 JVM이 OS가 bytecode를 이해할 수 있도록 실시간 번역기 또는 JIT컴파일러에 의해 바이너리 코드로 해석해서 OS에 전달한다.

## 1-3. 정리 
* 원시코드를 실행하기 위해 CPU가 이해하는 언어는 바이너리 코드
  * (*.java -> *.class by javac.exe)
* JVM이 이해하는 코드는 바이트 코드이다.
  * (바이트코드(*.class) -> 바이너리 코드 by 실시간 번역기 or JIT)
* JIT(Just In Time compliation) 또는 동적 번역이라고 한다. 
  


## 2. 구조
<img height="400" align="center" alt="JVM" src="https://user-images.githubusercontent.com/87313203/201865273-46694ca0-3382-4a58-991e-5c9567e4830a.png">

## Class Loader(클래스 로더)
자바 컴파일러를 사용해 컴파일한 *.class파일을 Class Loader를 통해 JVM에 로드하고, 링크를 통해 Runtime Date Area에 배치한다. 

## Execution Engine
로드된 *.class파일을 실행시키는 역할을 한다. 
* Interpreter 
 * 바이트 코드를 명령어 단위로 읽어서 실행하는 인터프리터. 한 줄씩 수행하기 때문에 느리다. 
* JIT 컴파일러 
 * 프로그램을 실행하는 시점에 기계어로 번역하는 컴파일러
 * 인터프리터 방식으로 한줄씩 해석하다가 적절한 시점에 바이트 코드 전체를 컴파일하여 기계어로 변경하고, 이후에는 더이상 인터프리팅 하지 않고 기계어로 직접 실행하는 방식 
 * 기계어는 캐시에 보관하기 때문에 한 번 컴파일된 코드는 빠르게 수행된다. JIT컴파일러가 컴파일하는 과정은 바이트코드를 인터프리팅하는 것보다 훨씬 오래걸리기 때문에 한 번만 실행되는 코드라면 컴파일하지 않고, 인터프리팅하는 것이 유리하다. 
 * JIT컴파일러를 사용하는 JVM들은 내부적으로 해당 메서드가 얼마나 자주 수행되는지 체크하고 일정 정도를 넘을때만 수행한다. 

## Garbage Collector 
동적 할당된 메모리 영역(heap)중에서 더 이상 사용하지 않는 영역을 탐지하여 자동으로 해지하는 기법으로, 프로그래머가 메모리를 따로 관리하지 않아도 된다. 

## Runtime Date Area
자바 프로그램을 수행하기 위해 OS에서 할당 받은 메모리 공간이다 
* PC Register 
 * JVM은 스택 기반의 방식으로 작동하는데, CPU에 직접 명령을 수행하지 않고, 스택에서 명령어의 주소를 뽑아 이를 별도의 메모리 공간에 저장한다. 즉, 현재 실행해야 하는 명령어의 주소를 기록한다. 
* JVM Stack 
 * 프로그램 실행과정에서 호출된 <b>메서드의 파라미터, 지역 변수, 리턴 값, 연산 값 등이 임시로 저장</b>되는 영역
* Native Method Stack 
 * 바이트 코드가 아닌 실제 실행할 수  있는 기계어로 작성된 프로그램을 실행시키는 영역이다. 
* Heap
 * GC의 대상이 되는 영역. 프로그램 실행 중 생성되는 인스턴스(new ~)는 모두 여기에 생성된다. 
* Method Area
 * 프로그램 실행 중 어떤 클래스가 사용되면, JVM은 해당 클래스의 클래스 파일을 읽어서 분석하여 클래스에 대한 정보를 이곳에 저장한다.
 * 사용되는 클래스의 클래스 변수도 여기에 함께 생성된다.
